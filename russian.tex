\documentclass[a4paper,12pt,hyphens]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{textcase}
\usepackage{dtk-logos}
\usepackage{hologo}

\usepackage{microtype}
\usepackage{fontspec}
\setmainfont{STIX Two Text}
\setmonofont{PT Mono}[Scale=0.9]
\usepackage[english,russian]{babel}
\usepackage{csquotes}

\usepackage{unicode-math}
\setmathfont{STIX Two Math}

\usepackage[margin=2cm]{geometry}
\usepackage{verbatim}

\usepackage{booktabs}
\usepackage{multirow}

\usepackage{tabularray}
\UseTblrLibrary{booktabs}
\SetTblrInner{rowsep=0pt}

\usepackage[style=gost-numeric,
            defernumbers=true,
            autolang=other,
            maxbibnames=5,
            maxcitenames=2,
            movenames=false]{biblatex}
\addbibresource{refs.bib}

\DefineBibliographyExtras{russian}{\protected\def\bibrangedash{\textendash}}

\usepackage[noautomatic]{imakeidx}
\makeindex

\usepackage{tcolorbox}
\tcbuselibrary{skins,listings,minted}
\usemintedstyle{xcode}
\tcbset{enhanced,colback=black!5,colframe=black!5,fuzzy shadow={0.5mm}{-0.5mm}{-1.0mm}{0.5mm}{black!50}}
\newtcblisting{latexcode}{listing only,minted language=latex,minted options={fontsize=\footnotesize}}
\newtcblisting{bibtexcode}{listing only,minted language=bibtex,minted options={fontsize=\footnotesize}}
\newtcblisting{latexmkcode}{listing only,minted language=perl,minted options={fontsize=\footnotesize}}
\newtcblisting{makecode}{listing only,minted language=make,minted options={fontsize=\footnotesize}}
\newtcblisting{shcode}{listing only,minted language=shell-session,minted options={fontsize=\footnotesize}}
\newtcblisting{xindycode}{listing only,minted language=lisp,minted options={fontsize=\footnotesize}}
\newtcblisting{istcode}{listing only,minted language=tcl,minted options={fontsize=\footnotesize}}

\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand\headrulewidth{0pt}
\fancyhead{}
\fancyfoot[C]{\fontspec{STIX Two Text}\thepage}

\usepackage{titlesec}
\titleformat{\subsection}{\fontspec{STIX Two Text}\large\bfseries}{\thesubsection}{1em}{}

\usepackage{titletoc}
\titlecontents{section}
[2.8em]
{\smallskip}
{\contentslabel{1.8em}}
{\hspace*{-1.8em}}
{\titlerule*[1pc]{.}\contentspage}

\titlecontents{subsection}
[5.6em]
{\vspace{3pt}}
{\contentslabel{2.8em}}
{\hspace*{-2.8em}}
{\titlerule*[1pc]{.}\contentspage}

\usepackage[colorlinks,allcolors=blue,hyperindex=false]{hyperref}
\newcommand\foothref[2]{%
  \href{#1}{#2}\footnote{\url{#1}}%
}

\usepackage{fnpct}

\newcommand\softname[1]{\textit{#1}}
\newcommand\package[1]{\texttt{#1}}
\newcommand\exe[1]{\texttt{#1}}
\newcommand\file[1]{\texttt{#1}}
\newcommand\lcmd[1]{\mintinline{latex}{#1}}
\DeclareRobustCommand{\myBibTeX}{\BibTeX}

\usepackage{epigraph}

\title{\LaTeX\ в 2024 году}
\author{Сергей Головань}
%\date{}

\renewcommand\topfraction{1}
\renewcommand\textfraction{0}
\setcounter{topnumber}{5}
\setcounter{totalnumber}{5}

\clubpenalty=10000
\widowpenalty=10000
\displaywidowpenalty=10000

\begin{document}
\pdfbookmark[1]{LaTEX в 2024 году}{title}%
\vspace{-\baselineskip}%
\maketitle
\pdfbookmark[1]{Содержание}{toc}%
\vspace{-\baselineskip}%
\tableofcontents

\clearpage
\section{Введение}
Система верстки \TeX\index{tex@\TeX} появилась в конце семидесятых годов прошлого века,
надстройка \LaTeX\index{latex@\LaTeX} --- в 1985 году, и с тех пор является распространённым
инструментом для вёрстки текстов, содержащих математические формулы (да и текст
без формул, свёрстанный с помощью \LaTeX, выглядит очень хорошо благодаря
качественным алгоритмам разбиения абзацев на строки). Оригинальный компилятор
\TeX\ на сегодняшний момент зафиксирован и не развивается, но несмотря на это
в мире \TeX\ происходит довольно много изменений в последние годы. Появляются
новые компиляторы (\XeTeX\index{xetex@\XeTeX}, \LuaTeX\index{luatex@\LuaTeX}), направленные
на более удобное использование
современных форматов шрифтов, на совершенствование поддержки многоязычных
документов. Совершенствуются вспомогательные средства (для обработки
библиографии, создания предметных указателей). В данной заметке я хочу
перечислить несколько своих решений о применении того или иного инструмента,
которые мне представляются разумными в 2024 году.

\parencite{evgrafov-evgrafov:1993}.
\parencite{spivak:1993}.
\parencite{knuth:1993}.
\parencite{knuth:2003a}.
\parencite{knuth:2003b}.
\parencite{gratzer:2000}.
\parencite{gussens-mittelbach-samarin:1999}.
\parencite{gussens-ratz-mittelbach:2002}.
\parencite{gussens-ratz:2001}.
\parencite{rozhenko:2005}.
\parencite{baldin:2008}.
\parencite{lvovskiy:2014}.
\parencite{kotelnikov-chebotaev:2016}.
\parencite{belyakov-palosh-sadovskiy:2012}.
\parencite{morozov-parhomenko:2011}.
\parencite{kottwitz:2022}.
\parencite{stolyarov:2010}.
\parencite{kuznetsov:2021}.
\parencite{vorontsov:2005}.
\parencite{lamport:1994}.
\parencite{mittelbach-fischer:2023}.
\parencite{kopka-daly:2004}.
\parencite{vinogradov:1992}.

\section{Кодировка: UTF-8}
Я познакомился с \LaTeX, будучи пользователем операционной системы MS DOS,
поэтому первой кириллической кодировкой для моих текстов была так называемая
альтернативная кодовая страница или CP866. Потом появился GNU/Linux и кодировка
KOI8-R, а потом оказалось, что обмениваться исходными текстами в этой кодировке
неудобно, так как все вокруг пользуются MS Windows, поэтому я перешел на
CP1251 (у которой по сравнению с KOI8-R есть и другие преимущества, например
более удобное множество символов). Однако если в тексте попадается какой-нибудь
нестандартный символ или слово (греческое, китайский иероглиф и т.\,п.), то
приходилось исхитряться, чтобы его набрать. Для европейских языков Дональд Кнут
предусмотрел ввод акцентов (\lcmd{u\v{z}ivatel} даёт u\v{z}ivatel), а что с
остальными? Всё изменилось с распространением юникодной кодировки UTF-8. Сейчас
она уже самая распространённая среди пользователей GNU/Linux и MacOS X,
а пользователю MS Windows вполне можно рекомендовать какой-нибудь удобный
редактор для \TeX, например \softname{TeXmaker} \parencite{site-texmaker}
или \softname{TeXstudio} \parencite{site-texstudio} с её поддержкой.

Так что в данном случае выбор однозначный --- UTF-8. \LuaTeX\ и \XeTeX\ поддерживают
UTF-8 «из коробки» как основную и единственную кодировку (\LuaLaTeX\ можно
заставить работать с восьмибитными документами, но зачем?), обычный \TeX\
и \pdfTeX\ с UTF-8 работают просто как с потоком отдельных байтов, так что
для поддержки UTF-8 в \LaTeX\ необходимо подключать пакет \package{inputenc}
с опцией \lcmd{[utf8]}.

\section{Компилятор: \LuaTeX\ и формат \LuaLaTeX}
У меня как у русскоязычного пользователя \TeX\ не возникало нужды рассматривать
такие экзотические компиляторы, как p\TeX, созданный для качественной печати японских
текстов, но и без него существует много разных вариантов \TeX\ --- \eTeX, \pdfTeX,
\XeTeX, \LuaTeX\ и масса других. Прежде всего они отличаются
друг от друга
\begin{itemize}
\item форматом исходящего документа (DVI или PDF),
\item поддержкой юникодных кодировок,
\item общей возможностью использования системных ресурсов (в оригинальном \TeX,
скажем, было всего 256 числовых регистров),
\item поддержкой разных форматов шрифтов.
\end{itemize}

Если говорить про выбор DVI против PDF, то единственное, чего мне некоторое время
не хватало в PDF по сравнению со связкой $\text{DVI}\to\text{PS}\to\text{PDF}$,
это пакета \package{psfrag}, вставляющего надписи в иллюстрации. Однако с тех
пор и векторные редакторы (скажем, \softname{Inkscape}, \cite{site-inkscape})
научились вставлять надписи,
отформатированные в \LaTeX, и появились удобные неинтерактивные средства создания
иллюстраций (например, \softname{Asymptote}
\begin{otherlanguage}{english}\parencite{site-asymptote,ctan-asymptote}\end{otherlanguage},
PGF/Ti\emph{k}z \parencite{ctan-pgf} и \package{pgfplots} \parencite{ctan-pgfplots},
\softname{Matplotlib} \parencite{site-matplotlib}), так что нужда в \package{psfrag}
отпала. А поскольку сам по себе формат DVI непереносим (иллюстрации не
внедряются, шрифты не внедряются), то получается, что лучшим форматом на данный
момент является PDF. В этом формате выдают результат \pdfTeX, \LuaTeX\ (непосредственно)
и \XeTeX\ (через промежуточный вывод в расширенный формат DVI).
Дополнительным преимуществом компиляторов, выводящим результат непосредственно в PDF,
является поддержка микротипографических расширений с помощью пакета
\package{microtype} \parencite{ctan-microtype}, все возможности которого реализованы в
\pdfTeX\ и \LuaTeX, и только малая часть~--- в \XeTeX.

Так как я предпочитаю новые документы создавать в кодировке UTF-8, то хорошо было
бы, чтобы компилятор мог с ней работать. \pdfTeX\ работает с текстом как с потоком
байтов, поэтому поддержку UTF-8 приходится реализовывать внутри макропакета \LaTeX.
Это делает \package{inputenc}
\begin{otherlanguage}{english}\parencite{ctan-inputenc,se-inputenc}\end{otherlanguage}.
Минусом данного решения является то, что, скажем,
при составлении предметного указателя вспомогательный файл со списком слов
вместо русских букв содержит списки макросов вроде \lcmd{\IeC {\cyro }},
а значит для его обработки программой создания указателя необходимо заменить
все эти макросы на буквы. Это несложно, но создаёт некоторые неудобства.
\XeTeX\ и \LuaTeX\ поддерживают UTF-8 изначально, поэтому с этой точки зрения
они предпочтительнее.

\pdfTeX, как и обычный \TeX, требует наличия отдельных метрик шрифтов в виде
файлов формата TFM. Этот формат весьма ограничен, в частности он поддерживает не
более 256 символов в одном шрифте. Поэтому многоязычная работа становится не
слишком удобной. Приходится переключать кодировку шрифта для фраз на других
языках. \XeTeX\ и \LuaTeX\ способны работать со шрифтами в формате TTF и OTF
непосредственно, а в них число символов практически не ограничено. Но в
данном аспекте мне больше нравится \LuaTeX, который с помощью пакета
\package{luaotfload} может подключать шрифты, расположенные в дереве
дистрибутива \TeX, по их названиям, а не только по
именам файлов как для \XeTeX. Это делает его более переносимым между
платформами.

Следует отметить, что \LuaTeX\ довольно молодой проект, поэтому в нём еще
встречаются ошибки. Так, например, неправильное расположение пределов
интегрирования при использовании \package{unicode-math} починили совсем недавно,
в версии 1.0. Также \LuaTeX\ существенно медленнее, чем \pdfTeX, особенно в части
загрузки шрифтов. Впрочем, потеря нескольких секунд на документ не кажется мне
существенным недостатком.

Таким образом, несмотря на отдельные недостатки, по совокупности доставляемых
удобств на данный момент я выбираю компилятор \LuaTeX.

\section{Набор математики: unicode-math?}
С тех пор, как в Unicode включили массу математических символов, а потом с
помощью компании Microsoft в спецификации формата шрифтов OTF
появилась таблица MATH, в \LuaLaTeX\ и \XeTeX\ реализовали альтернативный
способ верстки математических формул~--- посредством пакета
\package{unicode-math} \parencite{ctan-unicode-math}.\index{набор математики}
Также начали разрабатываться шрифты с поддержкой юникодной математики. Примеры таких
шрифтов: \emph{Latin Modern Math}, \emph{Asana Math}, \emph{XITS Math},
\emph{STIX Two Math} и другие (в разделе~\ref{sec:fonts} данного документа приведены
примеры текстов, набранных разными шрифтами с математическими формулами, выведенными
с помощью \package{unicode-math}).
При этом традиционный метод вёрстки математических формул не исчез, что
очень радует, так как всё-таки \package{unicode-math} в сочетании со шрифтами
Computer Modern (или их клонами) пока еще выглядит не вполне хорошо.
Также старым способом приходится пользоваться для набора, скажем, шрифтом
Euler, который мне тоже нравится (время не стоит на месте, уже появился шрифт Euler Math,
работающий с \package{unicode-math}, см. раздел~\ref{sec:euler}). Сам процесс набора с помощью \package{unicode-math}
мало отличается от обычного~--- те же команды. Но некоторые приятные особенности всё-таки
есть. В частности, не нужно больше использовать разрозненный набор команд
печати всевозможных полужирных вариантов начертания: \lcmd{\mathbf}, \lcmd{\boldkey},
\lcmd{\boldsymbol}. Переключение происходит командами с~унифицированными именами:
\lcmd{\symbfup}, \lcmd{\symbfit} (для прямого и курсивного вариантов), причём
действует и на греческие буквы.

В общем и целом на данный момент я пользуюсь традиционным набором математики,
если использую шрифты \emph{Computer Modern}, \emph{Euler} или другие старые шрифты, но
применяю \package{unicode-math} для гарнитур вроде \emph{STIX Two Math} или
\emph{Old Standard Math}.

\section{Шрифты: fontspec}
Подключение шрифтов к оригинальному \TeX\ всегда было делом непростым.
То есть, конечно же, были шрифты, написанные на \METAFONT\ специально для
\TeX, но сейчас можно смело сказать, что этот формат умер, и пользоваться
им довольно бессмысленно. Подключение же других форматов требует
дополнительной работы --- создания метрических файлов TFM, перекодировки
шрифта в одну или несколько 8-битных кодировок, поддерживаемых в \TeX,
и генерирования файла соответствия полученного внутреннего имени шрифта
оригинальному шрифтовому файлу.

\XeTeX\ и \LuaTeX\ позволяют исключить все эти этапы и работают
непосредственно со шрифтами в форматах TTF и OTF. И несмотря на то, что старые
шрифты им также доступны, таблицы переносов в \XeTeX\ и \LuaTeX\ работают только
совместно с юникодными шрифтами, так что если мне нужен старый шрифт вроде гарнитуры
Литературная, который в бесплатном виде доступен только в формате Type1, то приходится
возвращаться к \pdfLaTeX. Для удобства подключения современных шрифтов
предназначен пакет \package{fontspec} \parencite{ctan-fontspec}.
На рис.~\ref{fontspec1}
\begin{figure}[tp]
\begin{latexcode}
\usepackage{fontspec}
\setmainfont{STIX Two Text}[Ligatures=TeX]
\setmonofont{PT Mono}[Scale=0.9]
\end{latexcode}
\caption{Подключение шрифтов с использованием
\package{fontspec}}\label{fontspec1}
\end{figure}
приведён пример такого подключения. При этом пакет обладает большой
гибкостью, при использовании шрифта можно учитывать его дополнительные
свойства: различного рода лигатуры, варианты написания отдельных
символов и т.~п. Также \package{fontspec} сам реализует некоторые
возможности, такие как масштабирование шрифта, дополнительные наборы
лигатур (привычных пользователям \TeX, таких как
$\mbox{\lcmd{---}}\mapsto\text{---}$ или $\mbox{\lcmd{<<>>}}\mapsto\text{<<>>}$)
и ещё массу всяких нужных и не очень.

Поэтому в данном случае выбирать особо не приходится: Пакет \package{fontspec}
является единственным удобным средством выбора шрифтов для \LuaLaTeX. Если требуется использование
старого шрифта, который недоступен в формате OTF/TTF, то я возвращаюсь на \pdfLaTeX.

\section{Пакет локализации: babel}
Сейчас существует два распространённых пакета, которые отвечают за
локализацию документа~---
\package{babel} \parencite{ctan-babel} и
\package{polyglossia} \parencite{ctan-polyglossia}.\index{локализация}
Первый из них это старый заслуженный пакет, работающий со всеми
вариантами \TeX\ (поддержка динамической загрузки правил для
переноса слов, которая применяется в \LuaTeX, появилась сравнительно
недавно). Второй~--- более молодой пакет, работающий только в \XeLaTeX\ и в \LuaLaTeX.
С другой стороны
пользовательский интерфейс у \package{polyglossia} мне нравится чуть больше,
чем у \package{babel}, он ближе к интерфейсу пакета \package{fontspec}
выбора шрифтов. На рисунках~\ref{babel2}--\ref{polygl1}
приведены примеры подключения этих пакетов.
\begin{figure}[tp]
\begin{latexcode}
\usepackage[english,russian]{babel}
\end{latexcode}
\caption{Подключение пакета \package{babel} в \LuaLaTeX}\label{babel2}
\end{figure}
\begin{figure}[tp]
\begin{latexcode}
\usepackage{polyglossia}
\setmainlanguage{russian}
\setotherlanguage{english}
\end{latexcode}
\caption{Подключение пакета \package{polyglossia} в \LuaLaTeX}\label{polygl1}
\end{figure}

Какой же из них выбрать? Мне для работы (в основном с русским и английским языками)
вполне подходят оба эти пакета. И я выбираю пакет \package{babel} только потому, что
он мне более привычен. Ну и время от времени я всё-таки пользуюсь \pdfLaTeX, а там
выбора нет.

\section{Таблицы: tabularray}
Набор таблиц в \LaTeX\ всегда был делом непростым. Стандартные средства \LaTeX\ по умолчанию генерируют таблицы весьма посредственного качества, а уж если есть необходимость в использовании объединенных ячеек, то и исходный текст превращается в нечитаемую кашу. Для набора сколько-нибудь сложных таблиц приходится подключать множество разных пакетов: \package{multirow} \parencite{ctan-multirow} для объединения ячеек по вертикали, \package{tabularx} \parencite{ctan-tabularx} для автоматического выбора ширины ячеек с переносами строк, \package{longtable} \parencite{ctan-longtable} для вёрстки таблиц, высота которых выше, чем высота страницы, \package{booktabs} \parencite{ctan-booktabs} для более качественной вёрстки таблиц с горизонтальными линиями (при этом вертикальные линии становится использовать почти невозможно, в них появляются разрывы), \package{colortbl} \parencite{ctan-colortbl} для печати цветных таблиц (также плохо совместим с \package{booktabs}) и другие. Однако, в 2021 году вышел пакет \package{tabularray} \parencite{ctan-tabularray}~--- новый пакет для набора и вёрстки таблиц в \LaTeX, который оказался настолько удачным, что заменил все приведённые выше пакеты. Единственная проблема этого пакета (с которой мне самому не приходилось сталкиваться), это его медленная работа. Утверждается, что вёрстка таблицы из тысячи строк может занимать более часа. На рис.~\ref{tabular1} и~\ref{tabularray1} приведены исходные тексты для вёрстки таблиц с одним и тем же содержанием, изображённых на рис.~\ref{tabular2} и~\ref{tabularray2}.%
\begin{figure}[tp]
\begin{latexcode}
...
\usepackage{booktabs}
\usepackage{multirow}
...
\begin{tabular}{lccccc}
\toprule
\multirow{2}{*}[-0.5ex]{Категория} & \multicolumn{3}{c}{Бинарный классификатор} &
\multirow{2}{*}[-0.5ex]{Голоса} & \multirow{2}{*}[-0.5ex]{Результат} \\
\cmidrule(lr){2-4}
        & 1 vs. 2  & 1 vs. 3  & 2 vs. 3  \\
\midrule
Класс 1 & Выигрыш  & Выигрыш  & --       & 2 & Выигрыш \\ 
Класс 2 & Проигрыш & --       & Выигрыш  & 1 & Проигрыш \\ 
Класс 3 & --       & Проигрыш & Проигрыш & 0 & Проигрыш \\ 
\bottomrule
\end{tabular}
\end{latexcode}
\caption{Вёрстка таблицы с помощью окружения \package{tabular}}\label{tabular1}
\end{figure}%
\begin{figure}[tp]
\begin{latexcode}
...
\usepackage{tabularray}
\UseTblrLibrary{booktabs}
\SetTblrInner{rowsep=0pt}
...
\begin{booktabs}{
  colspec={lccccc},
  cell{1}{1,5,6}={r=2}{},
  cell{1}{2}={c=3}{}
}
\toprule
Категория & Бинарный классификатор   &  &  & Голоса & Результат \\
\cmidrule[lr]{2-4}
          & 1 vs. 2  & 1 vs. 3  & 2 vs. 3  \\
\midrule
Класс 1   & Выигрыш  & Выигрыш  & --       & 2      & Выигрыш \\ 
Класс 2   & Проигрыш & --       & Выигрыш  & 1      & Проигрыш \\ 
Класс 3   & --       & Проигрыш & Проигрыш & 0      & Проигрыш \\ 
\bottomrule
\end{booktabs}
\end{latexcode}
\caption{Вёрстка таблицы с помощью окружения \package{booktabs} (пакет \package{tabularray})}\label{tabularray1}
\end{figure}%
\begin{figure}[tp]
\begin{tcolorbox}[colback=white,colframe=white]
\centering
\begin{tabular}{lccccc}
\toprule
\multirow{2}{*}[-0.5ex]{Категория} & \multicolumn{3}{c}{Бинарный классификатор} &
\multirow{2}{*}[-0.5ex]{Голоса} & \multirow{2}{*}[-0.5ex]{Результат} \\
\cmidrule(lr){2-4}
        & 1 vs. 2  & 1 vs. 3  & 2 vs. 3  \\
\midrule
Класс 1 & Выигрыш  & Выигрыш  & --       & 2 & Выигрыш \\ 
Класс 2 & Проигрыш & --       & Выигрыш  & 1 & Проигрыш \\ 
Класс 3 & --       & Проигрыш & Проигрыш & 0 & Проигрыш \\ 
\bottomrule
\end{tabular}
\end{tcolorbox}
\caption{Результат вёрстки таблицы с помощью окружения \package{tabular}}\label{tabular2}
\end{figure}%
\begin{figure}[tp]
\begin{tcolorbox}[colback=white,colframe=white]
\centering
\begin{booktabs}{
  colspec={lccccc},
  cell{1}{1,5,6}={r=2}{},
  cell{1}{2}={c=3}{}
}
\toprule
Категория & Бинарный классификатор   &  &  & Голоса & Результат \\
\cmidrule[lr]{2-4}
          & 1 vs. 2  & 1 vs. 3  & 2 vs. 3  \\
\midrule
Класс 1   & Выигрыш  & Выигрыш  & --       & 2      & Выигрыш \\ 
Класс 2   & Проигрыш & --       & Выигрыш  & 1      & Проигрыш \\ 
Класс 3   & --       & Проигрыш & Проигрыш & 0      & Проигрыш \\ 
\bottomrule
\end{booktabs}
\end{tcolorbox}
\caption{Результат вёрстки таблицы с помощью окружения \package{booktabs} (пакет \package{tabularray})}\label{tabularray2}
\end{figure}
Как можно видеть из рис.~\ref{tabular2} и~\ref{tabularray2}, результаты получились почти идентичными, но при этом исходный текст для окружения \package{booktabs} из пакета \package{tabularray} (рис.~\ref{tabularray1}) выглядит намного более читаемым, чем исходный текст для окружения \package{tabular} (рис.~\ref{tabular1}). При использовании окружения \package{tabular} пришлось даже вручную подправить положение текста в ячейках, объединённых по вертикали. Приведу также пример длинной таблицы, не помещающейся целиком на одной странице (в данном случае в одной колонке) со строками разных цветов (рис.~\ref{tabularray3} и~\ref{tabularray4}).
\begin{figure}[tp]
\begin{latexcode}
...
\usepackage{tabularray}
\DefTblrTemplate{conthead-text}{default}{(продолжение)}%
\DefTblrTemplate{contfoot-text}{default}{Продолжение следует}%
...
\begin{longtblr}[
  label={table1},
  caption={Пример},
  remark{Примечание}={Таблица не помещается на страницу.}
]{
  colspec={XX},
  rowhead=1,
  rowfoot=1,
  row{even}={bg=black!10!white},
  row{1}={bg=black!50!white,fg=white},
  row{Z}={bg=black!40!white,fg=white},
  hline{1,Z}={1pt},
  hline{2,Y}={0.5pt}
}
Заголовок & Заголовок \\
Альфа     & Бета      \\
Гамма     & Дельта    \\
Эпсилон   & Дзета     \\
Эта       & Тета      \\
Йота      & Каппа     \\
Лямбда    & Мю        \\
Ню        & Кси       \\
Омикрон   & Пи        \\
Ро        & Сигма     \\
Тау       & Ипсилон   \\
Фи        & Хи        \\
Пси       & Омега     \\
Подвал    & Подвал    \\
\end{longtblr}
\end{latexcode}
\caption{Вёрстка таблицы с помощью окружения \package{longtblr} (пакет \package{tabularray})}\label{tabularray3}
\end{figure}%
\begin{figure}[tp]
\DefTblrTemplate{conthead-text}{default}{(продолжение)}%
\DefTblrTemplate{contfoot-text}{default}{Продолжение следует}%
\begin{tcolorbox}[colback=white,colframe=white]%
\vbox to 8.5cm {%
\begin{multicols}{2}%
\vspace*{-11pt}
\begin{longtblr}[
  label={table1},
  caption={Пример},
  remark{Примечание}={Таблица не помещается на страницу.},
  presep=0pt
]{
  colspec={XX},
  rowhead=1,
  rowfoot=1,
  row{even}={bg=black!10!white},
  row{1}={bg=black!50!white,fg=white},
  row{Z}={bg=black!40!white,fg=white},
  hline{1,Z}={1pt},
  hline{2,Y}={0.5pt}
}
Заголовок & Заголовок \\
Альфа     & Бета      \\
Гамма     & Дельта    \\
Эпсилон   & Дзета     \\
Эта       & Тета      \\
Йота      & Каппа     \\
Лямбда    & Мю        \\
Ню        & Кси       \\
Омикрон   & Пи        \\
Ро        & Сигма     \\
Тау       & Ипсилон   \\
Фи        & Хи        \\
Пси       & Омега     \\
Подвал    & Подвал    \\
\end{longtblr}
\end{multicols}}
\end{tcolorbox}
\caption{Результат вёрстки таблицы с помощью окружения \package{longtblr} (пакет \package{tabularray})}\label{tabularray4}
\end{figure}

Кроме пакета \package{tabularray} также стоит обратить внимание на пакет \package{nicematrix} \parencite{ctan-nicematrix}.
Он также позволяет верстать сложные таблицы и матрицы. При этом используется \softname{TikZ} для расположения и форматирования
отдельных ячеек.

\section{Библиография: biblatex и biber}
Исторически первым инструментом для автоматического построения
списка литературы стал \BibTeX\ \parencite{ctan-bibtex}. При его
использовании источники
помещаются в отдельный файл (см. рис.~\ref{bibfile}).
\begin{figure}[tp]
\begin{bibtexcode}
@book{yolkin1997,
  title={Редукция нелинейных управляемых систем.
         Дифференциально"=геометрический подход},
  author={Ёлкин, Владимир Иванович},
  date={1997},
  location={M.},
  publisher={Наука},
  pagetotal={320},
  langid={russian},
}

@book{esin1950,
  title={Физическая химия пирометаллургических процессов},
  author={Есин, Олег Алексеевич and Гельд, Павел Владимирович},
  date={1950},
  location={M.},
  publisher={Государственное научно"=техническое издательство
             литературы по черной и цветной металлургии},
  pagetotal={510},
  langid={russian},
}

@book{eliseeva2010,
  title={Статистика},
  author={Елисеева, Ирина Ильинична},
  date={2010},
  location={СПб.},
  publisher={Издательский дом «Питер»},
  pagetotal={361},
  langid={russian},
}

@book{chebyshev1859,
  title={О правѣ наказанія: Рѣчь, произнесенная в торжественном
         собраніи Демидовскаго лицея 29 ноября, 1859 года},
  author={Чебышев-Дмитриев, Александр},
  date={1859},
  location={Ярославль},
  publisher={Фальк},
  pagetotal={152},
  url={http://books.google.it/books?id=uCYYAAAAYAAJ},
  langid={russian},
}
\end{bibtexcode}
\caption{Файл с источниками для списка литературы}\label{bibfile}
\end{figure}
Далее при каждом использовании команды~\lcmd{\cite{key}} соответствующая
ссылка записывается и отдельная утилита \package{bibtex} собирает эти
ссылки и формирует библиографию в соответствии с выбранным стилем оформления.
В частности, список может быть отсортирован по алфавиту, по году
публикации, в порядке цитирования и т.\,п.
(На рис.~\ref{bibliography} приведены команды, выбирающие стиль
\begin{figure}[tp]
\begin{latexcode}
\bibliographystyle{plain}
\bibliography{referencesfile}
\end{latexcode}
\caption{Печать списка литературы с помощью \myBibTeX}\label{bibliography}
\end{figure}
\begin{figure}[tp]
\begin{latexcode}
\usepackage[style=gost-numeric]{biblatex}
\addbibresource{referencesfile.bib}

...

\printbibliography
\end{latexcode}
\caption{Печать списка литературы с помощью \package{biblatex}}\label{biblatex1}
\end{figure}
списка литературы и собственно печатающая его.)
К сожалению, в своём оригинальном виде \BibTeX\ предназначается только
для работы с англоязычной литературой в кодировке ASCII (то, что
он как-то работает с восьмибитными кодировками --- счастливая случайность,
а то что в кодировке CP1251 ещё и сортировка по алфавиту работает,
кроме буквы <<Ё>>, это ещё одна приятная, но неожиданность). Поддержку различных
8-битных кодировок имеет \exe{bibtex8} \parencite{ctan-bibtex8},
однако подготовить с его помощью
список литературы с источниками, скажем, на русском и греческом языках
не удастся, так как вместе эти языки не помещаются в одну кодировку, а
использовать для разных источников разные кодировки программа не может.
Есть, однако, вариант и с поддержкой UTF-8, называется
\exe{bibtexu} \parencite{ctan-bibtexu,se-bibtexu},
--- проект недокументированный, и судя по всему, недописанный, так как
добиться правильной сортировки по алфавиту русскоязычных книг с ним
не удалось. Таким образом, \BibTeX\ и его усовершенствованные аналоги
плохо подходят для формирования многоязычного списка литературы.

К счастью, существует хорошая альтернатива: пакет
\package{biblatex} \parencite{ctan-biblatex,se-biblatex}
для печати списка литературы и
\exe{biber} \parencite{ctan-biber}
в качестве обработчика файла с источниками.
Пакет \package{biblatex} отвечает за печать библиографии и позволяет
это делать очень гибко. Настраивается почти всё, и для него доступно большое
количество готовых стилей, включая ГОСТ. На рис.~\ref{biblatex1}
приведены
команды, подключающие список литературы и печатающие его. На рисунке~\ref{biblatex2}%
\nocite{esin1950,yolkin1997,chebyshev1859,eliseeva2010}%
\index{Елисеева}%
\index{Ёлкин}%
\index{Есин}
\begin{figure}[tp]
\begin{tcolorbox}[colback=white,colframe=white]
\printbibliography[keyword=example,resetnumbers=1]
\end{tcolorbox}
\caption{Список литературы, выведенный с помощью \package{biblatex} и \exe{biber}}\label{biblatex2}
\end{figure}
показан результат.
\exe{biber} способен работать и с 8-битными кодировками, но по умолчанию
используется кодировка UTF-8, что позволяет удобно обрабатывать многоязычные
базы литературных источников, при этом не возникает проблем с корректной сортировкой
(как видно из примера на рис.~\ref{biblatex2}, многострадальная буква <<Ё>>
сортируется правильно --- вместе~с~<<Е>>) и выделением инициалов, в то время как
тот же \exe{bibtex} не может без специальных ухищрений правильно отделить
инициалы от имени и отчества, так как они в UTF-8 для кириллицы составляют не
один байт, а~два.

Таким образом, для печати списка литературы я на данный момент предпочитаю
\package{biblatex} и \exe{biber}. \exe{bibtex} использую только для англоязычных списков литературы,
если он требуется явным образом.

Есть еще один перспективный способ форматирования списков литературы --- использование Citation Style Language (CSL, \parencite{site-csl}).
Он применяется для вывода библиографии в таких продуктах, как \softname{LibreOffice} \parencite{site-libreoffice}, а также
в специализированных библиографических менеджерах, таких как \softname{Zotero} \parencite{site-zotero}, \softname{Mendeley} \parencite{site-mendeley},
\softname{Papers} \parencite{site-papers}. \LaTeX\ до недавнего времени не имел поддержки CSL при форматировании списков литературы,
но в 2022 году появилась первая рабочая версия пакета \package{citation-style-language} \parencite{ctan-citation-style-language}, применяющего CSL при верстке библиографии.
Пакет всё ещё находится на стадии активной разработки, поэтому для реальных приложений его использовать рановато, но в перспективе
будет удобно получать списки литературы, отформатированные в соответствии с выбранным стилем, число которых в официальном репозитории
\parencite{site-csl-styles} уже превысило~2500.

\section{Предметный указатель, глоссарий: upmendex}
\epigraph{Живут на ёлках\index{ёлка} белки, хоть ёлки и не елки\index{елка}.}{А. А. Милн, \emph{Винни-Пух и все-все-все} (пер.~Б.~Заходер)}
Печать предметного указателя или глоссария в \LaTeX\ обычно делается в два этапа. На первой стадии
командами \lcmd{\index{}} собирается информация об элементах списка,
на второй стадии они обрабатываются с помощью внешней программы, после
чего уже печатаются. Типичный пример~--- использование пакета \package{imakeidx} \parencite{ctan-imakeidx},
с которым \lcmd{\makeindex} открывает файл \file{docname.idx}, далее
обработка \package{makeindex} \parencite{ctan-makeindex}
\file{docname.idx} превращает его в \file{docname.ind},
который уже включается в тело документа с помощью команды \lcmd{\printindex}.

Как обычно, в \exe{makeindex} не предусмотрены никакие кодировки, кроме ASCII,
поэтому чтобы его применить к индексу на русском языке, приходилось прибегать
к разным ухищрениям (из подобных обёрток вырос
\exe{rumakeindex} когда-то \parencite{site-rumakeindex}). Ну и конечно
же работа в кодировке UTF-8 в \exe{makeindex} тоже невозможна без предварительного
перекодирования в какую-нибудь восьмибитную кодировку и потом перекодирования
результирующего файла обратно. А это весьма неудобно.

Некоторое время я пользовался \exe{xindy} \parencite{ctan-xindy} для печати предметных указателей. Эта программа
вполне удовлетворительно работает с указателями на нескольких языках, но требует для этого довольно специфической настройки.
Кроме того, документация \exe{xindy} не всегда понятная, ну и работает \exe{xindy} не всегда \parencite{se-xindy}.
Поэтому сейчас я отказался от использования \exe{xindy} и перешел на недавно появившийся \exe{upmendex} \parencite{ctan-upmendex}. Краткую инструкцию по настройке \exe{xindy} вы можете найти в приложении~\ref{sec:xindy}, она может пригодиться для случаев, когда \exe{upmendex} оказывается недостаточно гибким: он, например, не поддерживает глубину вложения указателей больше трех уровней.

\exe{upmendex} по использованию очень похож на оригинальный \exe{makeindex}, но работает только в кодировке UTF-8
и поддерживает огромное число языков и систем письма (латиница, кириллица, греческий, иероглифы, японская кана, деванагари и т.\,д.).
Для сортировки \exe{upmendex} использует библиотеку ICU (International Components for Unicode, \parencite{site-icu}),
соответственно, это обеспечивает правильную сортировку списков для подавляющего множества языков мира. Для простых
предметных указателей на русском и английском языке настройка сортировки сводится к указанию русской локали (английские
слова правильно сортируются по умолчанию). Если же нужна более гибкая настройка, то ICU и \exe{upmendex} позволяют
задавать настраиваемые правила сортировки, причем весьма гибко. В качестве примера приведу два совершенно бессмысленных
правила (но так тоже можно при желании). Первое выделяет букву <<Ё>> в отдельную группу: \texttt{\&Е<ё<<<Ё}. Второе, наоборот,
объединяет <<Й>> с буквой <<И>> в одну группу: \texttt{\&И<<й<<<Й}. Возможности почти безграничные.
На рис.~\ref{upmendex1} приведен пример файла настроек \exe{upmendex}, который годится для простого указателя на русском и английском языке.
\begin{figure}[tp]
\begin{istcode}
character_order "CL"
icu_locale "ru"

lethead_flag 1
lethead_prefix "\n  \\par\\textbf{"
lethead_suffix  "}\\par\\nopagebreak"
\end{istcode}
\caption{Список правил \file{ruseng.ist} для русско-английского указателя
\exe{upmendex}}\label{upmendex1}
\end{figure}
В этом примере сортировка происходит согласно русской локали независимо от регистра букв, при этом буквы
Е и Ё сортируются вместе (но не вперемешку, в одинаковых словах Ё идёт после Е,
как на рис.~\ref{upmendex4}).
\begin{figure}[tp]
\begin{tcolorbox}[colback=white,colframe=white]
\small
\vspace*{-2ex}
\printindex
\end{tcolorbox}
\caption{Предметный указатель, выведенный с помощью \package{imakeidx} и
\exe{upmendex}}\label{upmendex4}
\end{figure}
Хотелось бы также добавить, что использовать \exe{upmendex} вместе с \pdfLaTeX\ не так-то просто. \exe{upmendex} предполагает, что слова в \file{.idx} состоят из символов Unicode,
а \pdfLaTeX превращает кириллица выглядит в набор макросов вроде \lcmd{\IeC {\cyrp }}. Соответственно, для корректной обработки такого файла придется написать фильтр, перекодирующий такие макросы в буквы, и только потом запускать \exe{upmendex}. Если же пользователь все еще предпочитает 8-битную кодировку, то нужен будет еще один фильтр, который вернет макросы обратно после обработки индекса.
На рисунках~\ref{upmendex2} и~\ref{upmendex3}%
\begin{figure}[tp]
\begin{latexcode}
\usepackage[noautomatic]{imakeidx}
\makeindex

...

Живут на ёлках\index{ёлка} белки, хоть ёлки и не елки\index{елка}.

...

\printindex
\end{latexcode}
\caption{Предметный указатель в тексте документа}\label{upmendex2}
\end{figure}%
\begin{figure}[tp]
\begin{shcode}
% lualatex doc.tex

...

% upmendex -s ruseng.ist doc.idx

...

% lualatex doc.tex

...

%
\end{shcode}
\caption{Компиляция документа с предметным указателем}\label{upmendex3}
\end{figure}
можно увидеть, как именно программируется предметный указатель в тексте, и как он подключается в два прохода.

Следует сказать, что документирован \exe{upmendex} довольно лапидарно, поэтому кроме его документации имеет смысл заглядывать в документацию \exe{makeindex} и в документацию ICU \parencite{site-icu-docs}.
Но все мои потребности в части верстки предметных указателей \exe{upmendex} покрывает полностью.

\section{Система сборки: latexmk}
Строго говоря, система сборки нужна не всегда. Для случаев одиночных коротких
документов без оглавления, библиографии и т.~п. без нее вполне можно
обойтись. А вот если библиография, предметный указатель, перекрёстные
ссылки в документе есть, то система сборки, позволяющая не думать, сколько
раз запускать компилятор, \exe{biber}, \exe{upmendex}, существенно
повышает удобство использования \LaTeX. Для особо сложных случаев, когда
в одном проекте нужны разные компиляторы \LaTeX\ (есть у меня ещё такие со
стародавних времен), я использую GNU \exe{make} \parencite{site-make}
с довольно громоздким \file{Makefile}. Но для новых проектов гораздо
более удобным представляется
\exe{latexmk} \begin{otherlanguage}{english}\parencite{ctan-latexmk}\end{otherlanguage}\
с небольшим файлом конфигурации. В частности, данный документ успешно
собирается одной командой, представленной на рисунке~\ref{latexmk1},
\begin{figure}[tp]
\begin{shcode}
% latexmk russian.tex

...

%
\end{shcode}
\caption{Компиляция документа с помощью \exe{latexmk}}\label{latexmk1}
\end{figure}
с использованием конфигурационного файла с рисунка~\ref{latexmk2}.
\begin{figure}[tp]
\begin{latexmkcode}
$pdf_mode = 1;
$pdflatex = 'lualatex %O %S';
$makeindex = 'upmendex -s ruseng.ist %O %S';
$bibtex = 'biber %O %B'
\end{latexmkcode}
\caption{Конфигурационный файл \file{latexmkrc}}\label{latexmk2}
\end{figure}
В результате запуска \exe{latexmk} компилятор запускается несколько раз,
в промежутках вспомогательные файлы обрабатываются с помощью \exe{biber}
и \exe{upmendex} (при необходимости).

Впрочем, если проект достаточно сложный, с рисунками, которые генерируются
из исходных текстов разными способами (например, \file{figure1.pdf}
получается из \file{figure1.asy} запуском \verb|asy -f pdf figure1.asy|,
а \file{figure2.pdf} получается каким-нибудь другим способом, скажем
запуском \verb|Rscript figure2.r|), то объяснить \exe{latexmk}, что и как
надо запускать, становится нетривиально. Так что старый добрый \exe{make}
ещё послужит. Особенно в комбинации с \exe{latexmk}, то есть с правилом,
подобным представленному на рисунке~\ref{latexmk3}.
\begin{figure}[tp]
\begin{shcode}
...

%.pdf: %.tex
        latexmk -lualatex $<

...
\end{shcode}
\caption{Отрывок \file{Makefile} с использованием \exe{latexmk}}\label{latexmk3}
\end{figure}

\section{Средство для совместной работы: Git, Fossil}
Документы не всегда пишутся одним автором, часто над текстом работает несколько
человек. Поэтому системы для совместной работы существенно повышают удобство работы
над статьями, книгами и т.\,п. Это системы, позволяющие легко объединять фрагменты
текста, возвращаться к предыдущим вариантам и т.\,п. Более того, даже для одного автора
такие системы весьма удобны.

В настоящее время существуют облачные (онлайновые) сервисы для совместной работы с
документами в \LaTeX{}. Наиболее известным является \softname{Overleaf} \parencite{site-overleaf}
(его недавний главный конкурент \softname{ShareLaTeX} \parencite{site-sharelatex} с ним
объединился). Сервис работает прямо в Интернет-браузере, не требует установки дистрибутива
\LaTeX{} на локальный компьютер. Некоторые интересные его возможности доступны только
для платных подписчиков, скажем, создание закрытых совместных проекты, что иногда
хотелось бы. Ну и лично для меня неудобно то, что редактирование происходит в
браузере, то есть приходится подстраиваться под местный текстовый редактор
вместо того, чтобы пользоваться привычным мне. Ну и требование наличия довольно
быстрого канала в Интернет тоже не слишком приятно.

Другой класс систем совместной работы это системы управления версиями (Version
Control Systems). Их изобрели для работы с исходным кодом программ, но так как
\LaTeX{} работает с обычными текстовыми файлами на входе, то оказалось, что
системы управления версиями прекрасно справляются с документами \LaTeX{}.

Систем управления версиями существует огромное количество. Какую предпочесть?
Первый критерий --- распределённость. На текущий момент централизованную систему
я бы не стал выбирать (в конце концов наличие полной копии репозитория на каждом
рабочем компьютере играет роль своеобразной резервной копии, которых мало не
бывает). Второй критерий --- популярность, чем более распространена система, тем проще
найти для неё хостинг. Далее, пожалуй, любая система подойдёт, все они предоставляют
схожий интерфейс и примерно одинаковый перечень возможностей. На сегодняшний момент
лидером по распространённости является \softname{Git} \begin{otherlanguage}{english}\parencite{site-git}\end{otherlanguage}.
Хостинг для него можно найти, например, на \softname{Github} \parencite{site-github},
\softname{Bitbucket} \parencite{site-bitbucket}, \softname{Gitlab} \parencite{site-gitlab}
и во многих других местах. Какие-то из них предоставляют возможность создания закрытых
репозиториев бесплатно, другие нет.

Кроме того, для небольших проектов (в основном единолично разрабатываемых) я использую
\softname{Fossil} \parencite{site-fossil}. Он намного проще в установке, чем Git,
если репозиторий не размещать на публичном хостинге (то есть использовать вовсе без
хостинга или самостоятельно поддерживать), то он удобнее, так как формат самого
репозитория --- база данных \softname{SQLite} \parencite{site-sqlite} в отличие от
формата репозитория Git --- развесистого дерева поддиректорий с файлами. Соответственно,
для него удобно создавать резервные копии, его можно размещать на каком-нибудь облачном
ресурсе с общим доступом вроде \softname{Dropbox} \parencite{site-dropbox},
\softname{OwnCloud} \parencite{site-owncloud} или \softname{Syncthing}
\begin{otherlanguage}{english}\parencite{site-syncthing}\end{otherlanguage}.

\section{Пример документа}
В данном разделе приведу пример законченного документа, который можно скомпилировать
с помощью \LuaLaTeX{}, \exe{biber} и \exe{upmendex}. Если рядом с данным документом
разместить файл \file{latexmkrc} из примера на рисунке~\ref{latexmk2}, стилевой
файл \file{ruseng.ist} из примера на рисунке~\ref{upmendex1} для \exe{upmendex}, а также какой-нибудь
файл \file{referencesfile.bib}, то
сборку всего проекта можно будет осуществить одной командой \exe{latexmk}.
\begin{figure}[t]
\begin{latexcode}
\documentclass{article}
\usepackage{microtype}
\usepackage{fontspec}
\setmainfont{XITS}
\usepackage{unicode-math}
\setmathfont{XITS Math}
\usepackage[english,russian]{babel}
\usepackage[noautomatic]{imakeidx}
\makeindex
\usepackage[style=gost-authoryear]{biblatex}
\addbibresource{referencesfile.bib}

\title{Название статьи}
\author{А. В. Тор}

\begin{document}
\section{Введение}
Текст введения\index{введение}.
\section{Основной результат}
Текст основной части работы\index{результат}.
\section{Заключение}
Текст заключения\index{вывод}.
\printbibliography
\printindex
\end{document}
\end{latexcode}
\caption{Пример законченного документа}\label{docexample}
\end{figure}
\begin{figure}[t]
\begin{shcode}
% latexmk doc.tex

...

%
\end{shcode}
\caption{Пример сессии (на удивление коротенький)}\label{sessionexample}
\end{figure}

\section{Примеры математических шрифтов}\label{sec:fonts}
За последние несколько лет появилось довольно много
\emph{математических шрифтов} в формате OTF для использования с пакетом \package{unicode-math}
\parencite{se-mathfonts}. При этом существуют как коммерческие,
так и свободные шрифты. В данном разделе я попытался собрать те из них, для
которых нашелся подходящий текстовый шрифт, поддерживающий кириллицу. Все шрифты в примерах либо свободные,
либо включены в стандартный набор шрифтов Microsoft Windows. Несколько последних примеров набраны шрифтами без
засечек и, соответственно, хорошо подходят вместе с соответствующими текстовыми шрифтами для презентаций,
свёрстанных в \package{beamer}.

\renewcommand{\theHequation}{\thepage.\arabic{equation}}
\newcommand{\Res}{\operatorname{Res}}
\newcommand{\example}[1]{\par\medskip\noindent\textbf{#1:}\enskip\ignorespaces}
\newcommand{\mathsamplerus}[1]{%
  \example{Формула обращения}
  Пусть $g\colon\mathbb{R}^{+}\to\mathbb{R}$~--- \emph{ограниченная и непрерывная справа функция}, и~пусть
  $\varphi(\alpha)\mathrel{:=}\int_0^\infty e^{-\alpha t}g(t)\,dt$~--- её преобразование Лапласа.
  Тогда для любого $t>0$,
  \begin{equation}
    g(t) = \lim_{\varepsilon\to0}\lim_{\lambda\to\infty}\varepsilon^{-1}
           \sum_{\lambda t<k\leqslant(\lambda+\varepsilon)t}\frac{(-1)^k}{k!}\lambda^k\varphi^{(k)}(\lambda).
  \end{equation}

  \example{Решения системы дифф. уравнений}
  Пусть $\symbfup{v}(\symbfup{x},\symbf{\alpha})$~--- параметризованное векторное поле
  ($\symbfup{x}\in U$, $\symbf{\alpha}\in A$), где~$U$~--- область в~$\mathbb{R}^n$
  и $A$~--- область в~$\mathbb{R}^m$. Предположим, что~$\symbfup{v}$~принадлежит классу
  $C^k$ как функция $(\symbfup{x},\symbf{\alpha})$ для некоторого $k\geqslant2$.
  Рассмотрим систему дифференциальных уравнений в~$U$:
  \begin{equation}\label{eq:#1ODE}
    \dot{\symbfup{x}}=\symbfup{v}(\symbfup{x},\symbf{\alpha}),\quad\symbfup{x}\in U.
  \end{equation}
  Зафиксируем начальную точку $\symbfup{p}_0$ в $U$ и предположим, что
  $\symbfup{v}(\symbfup{p}_0, \symbf{\alpha}_0)\ne0$. Тогда для достаточно малых $t$, $|\symbfup{p}-\symbfup{p}_0|$ и
  $|\symbf{\alpha}-\symbf{\alpha}_0|$ у системы~\eqref{eq:#1ODE} существует единственное
  решение~ $\symbfup{x}_{\symbf{\alpha}}(t)$, удовлетворяющее начальному условию $\symbfup{x}_{\symbf{\alpha}}(0)=\symbfup{p}$,
  и это решение принадлежит классу $C^k$ по~$t$, $\symbfup{p}$ и~$\symbf{\alpha}$.

  \example{Формула \emph{Стирлинга}}
  \begin{equation}
    \Gamma(z) \sim e^{-z}z^{z−1/2}\sqrt{2\pi}\left[1+\frac{1}{12z}+\frac{1}{288z^2}-\frac{139}{51840z^3}+\dotsb\right],\quad
      \text{$z\to\infty$ при $\mathopen|\arg z\mathclose|<\pi$.}
  \end{equation}

  \example{Кривые \emph{Безье}}
  Для точек $z_1$, $z_2$, $z_3$, $z_4$ в $\mathbb{C}$ \emph{кривая Безье с контрольными точками $z_1$, $z_2$, $z_3$, $z_4$}
  определяется равенством
  \begin{equation*}
    z(t) \mathrel{∶=} (1−t)^3z_1+3(1−t)^2tz_2+3(1−t)t^2z_3+t^3z_4,\quad 0\leqslant t\leqslant 1.
  \end{equation*}
  Так как $(1−t)^3+3(1−t)^2t+3(1−t)t^2+t^3=(1-t+t)^3=1$, и все слагаемые неотрицательные при $0\leqslant t\leqslant1$, $z(t)$
  является выпуклой комбинацией четырёх точек $z_k$. Следовательно, кривая~$z(t)$ лежит в их выпуклой оболочке.
  При изменении~$t$ между~$0$ и~$1$ кривая движется от точки~$z_1$ к~точке~$z_4$, при этом начальное направление
  движения есть $z_2−z_1$, а~конечное~--- $z_4−z_3$.

  \example{Уравнения \emph{Максвелла}}
  \begin{align*}
    \symbfup{B}'&=−c\nabla\times\symbfup{E},\\
    \symbfup{E}'&=c\nabla\times\symbfup{B}−4\pi\symbfup{J}.
  \end{align*}

  \example{Теорема о вычетах}
  Пусть $f$~--- функция, \emph{голоморфная} в области $G$ всюду за исключением изолированного множества особых
  точек $a_1$, $a_2$,\dots, $a_m$.
  Пусть $\gamma$~--- \emph{спрямляемая кривая} в $G$, не~проходящая ни~через одну из точек $a_k$, и пусть
  $\gamma\approx0$ в $G$. Тогда
  \begin{equation*}
    \frac{1}{2\pi i}\int_\gamma f=\sum_{k=1}^m n(\gamma;a_k)\Res(f;a_k).
  \end{equation*}

  \example{Принцип максимума модуля}
  Пусть $G$~--- ограниченное открытое подмножество $\mathbb{C}$, и~пусть $f$~--- функция, непрерывная на $\overline{G}$
  и голоморфная в $G$. Тогда
  \begin{equation*}
    \max\{|f(z)|\colon z\in\overline{G}\}=\max\{|f(z)|\colon z\in\partial G\}.
  \end{equation*}

  \example{Тождество \emph{Якоби}}
  Определим \emph{тета-функцию $\theta$} равенством
  \begin{equation*}
    \theta(t) = \sum_{n=-\infty}^\infty\exp(-\pi n^2t),\quad t>0.
  \end{equation*}
  Тогда
  \begin{equation*}
    \theta(t)=t^{-1/2}\theta(1/t).
  \end{equation*}
}

\clearpage
\subsection[Cyrillic Modern \& Latin Modern Math]{Cyrillic Modern \parencite{font-nm} \& Latin Modern Math \parencite{ctan-lm-math}}
\setcounter{equation}{0}
\setmainfont{Cyrillic Modern}[ItalicFont=nmti,BoldFont=nmbx]
\setmathfont[version=lm,mathrm=sym]{Latin Modern Math}
\mathversion{lm}
\small
\begin{latexcode}
\setmainfont{Cyrillic Modern}[ItalicFont=nmti,BoldFont=nmbx]
\setmathfont{Latin Modern Math}
\end{latexcode}
\mathsamplerus{lm}

\clearpage
\normalsize
\subsection{STIX Two Text \& STIX Two Math}
\setcounter{equation}{0}
\setmainfont{STIX Two Text}
\setmathfont[version=stix2,mathrm=sym]{STIX Two Math}
\mathversion{stix2}
\small
\begin{latexcode}
\setmainfont{STIX Two Text}
\setmathfont{STIX Two Math}
\end{latexcode}
\mathsamplerus{stix2}

\clearpage
\normalsize
\subsection{Erewhon \& Erewhon Math}
\setcounter{equation}{0}
\setmainfont{Erewhon}
\setmathfont[version=erewhon,mathrm=sym]{Erewhon Math}
\mathversion{erewhon}
\small
\begin{latexcode}
\setmainfont{Erewhon}
\setmathfont{Erewhon Math}
\end{latexcode}
\mathsamplerus{erewhon}

\clearpage
\normalsize
\subsection{XITS \& XITS Math}
\setcounter{equation}{0}
\setmainfont{XITS}
\setmathfont[version=xits,mathrm=sym]{XITS Math}
\mathversion{xits}
\small
\begin{latexcode}
\setmainfont{XITS}
\setmathfont{XITS Math}
\end{latexcode}
\mathsamplerus{xits}

\clearpage
\normalsize
\subsection{Old Standard \& Old Standard Math}
\setcounter{equation}{0}
\setmainfont{Old Standard}
\setmathfont[version=oldstandard,mathrm=sym]{Old Standard Math}
\mathversion{oldstandard}
\small
\begin{latexcode}
\setmainfont{Old Standard}
\setmathfont{Old Stnadard Math}
\end{latexcode}
\mathsamplerus{oldstandard}

\clearpage
\normalsize
\subsection{Libertinus Serif \& Libertinus Math}
\setcounter{equation}{0}
\setmainfont{Libertinus Serif}
\setmathfont[version=libertinus,mathrm=sym]{Libertinus Math}
\mathversion{libertinus}
\small
\begin{latexcode}
\setmainfont{Libertinus Serif}
\setmathfont{Libertinus Math}
\end{latexcode}
\mathsamplerus{libertinus}

\clearpage
\normalsize
\subsection{EB Garamond \& Garamond Math}
\setcounter{equation}{0}
\setmainfont{EB Garamond}
\setmathfont[version=garamond,mathrm=sym]{Garamond Math}
\mathversion{garamond}
\small
\begin{latexcode}
\setmainfont{EB Garamond}
\setmathfont{Garamond Math}
\end{latexcode}
\mathsamplerus{garamond}

\clearpage
\normalsize
\subsection{DejaVu Serif \& TeX Gyre DejaVu Math}
\setcounter{equation}{0}
\setmainfont[Scale=0.92]{DejaVu Serif}
\setmathfont[Scale=0.92,version=dejavu,mathrm=sym]{TeX Gyre DejaVu Math}
\mathversion{dejavu}
\small
\begin{latexcode}
\setmainfont{DejaVu Serif}
\setmathfont{TeX Gyre DejaVu Math}
\end{latexcode}
\mathsamplerus{dejavu}

\clearpage
\normalsize
\subsection{Times New Roman \& TeX Gyre Termes Math}
\setcounter{equation}{0}
\setmainfont{Times New Roman}
\setmathfont[version=termes,mathrm=sym]{TeX Gyre Termes Math}
\mathversion{termes}
\small
\begin{latexcode}
\setmainfont{Times New Roman}
\setmathfont{TeX Gyre Termes Math}
\end{latexcode}
\mathsamplerus{termes}

\clearpage
\normalsize
\subsection{Century Schoolbook \& TeX Gyre Schola Math}
\setcounter{equation}{0}
\setmainfont{Century Schoolbook}
\setmathfont[version=schola,mathrm=sym]{TeX Gyre Schola Math}
\mathversion{schola}
\small
\begin{latexcode}
\setmainfont{Century Schoolbook}
\setmathfont{TeX Gyre Schola Math}
\end{latexcode}
\mathsamplerus{schola}

\clearpage
\normalsize
\subsection{Bookman Old Style \& TeX Gyre Bonum Math}
\setcounter{equation}{0}
\setmainfont[Scale=0.97]{Bookman Old Style}
\setmathfont[Scale=0.97,version=bonum,mathrm=sym]{TeX Gyre Bonum Math}
\mathversion{bonum}
\small
\begin{latexcode}
\setmainfont{Bookman Old Style}
\setmathfont{TeX Gyre Bonum Math}
\end{latexcode}
\mathsamplerus{bonum}

\clearpage
\normalsize
\subsection{Palatino Linotype \& TeX Gyre Pagella Math}
\setcounter{equation}{0}
\setmainfont{Palatino Linotype}
\setmathfont[version=pagella,mathrm=sym]{TeX Gyre Pagella Math}
\mathversion{pagella}
\small
\begin{latexcode}
\setmainfont{Palatino Linotype}
\setmathfont{TeX Gyre Pagella Math}
\end{latexcode}
\mathsamplerus{pagella}

\clearpage
\normalsize
\subsection{Palatino Linotype \& Asana Math}
\setcounter{equation}{0}
\setmainfont{Palatino Linotype}
\setmathfont[version=asana,mathrm=sym]{Asana Math}
\mathversion{asana}
\small
\begin{latexcode}
\setmainfont{Palatino Linotype}
\setmathfont{Asana Math}
\end{latexcode}
\mathsamplerus{asana}

\clearpage
\normalsize
\subsection{Cambria \& Cambria Math}
\setcounter{equation}{0}
\setmainfont{Cambria}[BoldFont={Cambria Bold},BoldItalicFont={Cambria Bold Italic}]
\setmathfont[version=cambria,mathrm=sym]{Cambria Math}
\mathversion{cambria}
\small
\begin{latexcode}
\setmainfont{Cambria}[BoldFont={Cambria Bold},
                      BoldItalicFont={Cambria Bold Italic}]
\setmathfont{Cambria Math}
\end{latexcode}
\mathsamplerus{cambria}

\clearpage
\normalsize
\subsection{PT Serif \& Cambria Math}
\setcounter{equation}{0}
\setmainfont{PT Serif}
\setmathfont[Scale=MatchUppercase,version=pt,mathrm=sym]{Cambria Math}
\mathversion{pt}
\small
\begin{latexcode}
\setmainfont{PT Serif}
\setmathfont[Scale=MatchUppercase]{Cambria Math}
\end{latexcode}
\mathsamplerus{pt}

\clearpage
\normalsize
\subsection{XCharter \& XCharter Math}
\setcounter{equation}{0}
\setmainfont{XCharter}
\setmathfont[version=xcharter,mathrm=sym]{XCharter Math}
\mathversion{xcharter}
\small
\begin{latexcode}
\usepackage{xcharter-otf}
\end{latexcode}
\mathsamplerus{xcharter}

\clearpage
\normalsize
\subsection{Spectral \& Euler Math}\label{sec:euler}
\setcounter{equation}{0}
\setmainfont{Spectral}
\setmathfont[version=euler,math-style=upright]{Euler Math}
\mathversion{euler}
\setoperatorfont{\textrm}
\small
\begin{latexcode}
\setmainfont{Spectral}
\usepackage{euler-math}
\end{latexcode}
\mathsamplerus{euler}

\clearpage
\normalsize
\subsection{Fira Sans \& Fira Math}
\setcounter{equation}{0}
\setmainfont{Fira Sans}
\setmathfont[version=fira,math-style=TeX,mathrm=sym]{Fira Math}
\mathversion{fira}
\small
\begin{latexcode}
\setmainfont{Fira Sans}
\setmathfont{Fira Math}
\end{latexcode}
\mathsamplerus{fira}

\clearpage
\normalsize
\subsection{PT Sans \& Fira Math}
\setcounter{equation}{0}
\setmainfont{PT Sans}
\setmathfont[Scale=MatchLowercase,ScaleAgain=0.99999,version=ptsans,mathrm=sym]{Fira Math}
\mathversion{ptsans}
\small
\begin{latexcode}
\setmainfont{PT Sans}
\setmathfont[Scale=MatchLowercase]{Fira Math}
\end{latexcode}
\mathsamplerus{ptsans}

\clearpage
\normalsize
\subsection{Lato \& Lato Math}
\setcounter{equation}{0}
\setmainfont{Lato}
\setmathfont[version=lato,mathrm=sym]{Lato Math}
\mathversion{lato}
\small
\begin{latexcode}
\setmainfont{Lato}
\setmathfont{Lato Math}
\end{latexcode}
\mathsamplerus{lato}

\clearpage
\normalsize
\subsection{Segoe UI \& Lato Math}
\setcounter{equation}{0}
\setmainfont{Segoe UI}
\setmathfont[version=segoeui,mathrm=sym]{Lato Math}
\mathversion{segoeui}
\small
\begin{latexcode}
\setmainfont{Segoe UI}
\setmathfont{Lato Math}
\end{latexcode}
\mathsamplerus{segoeui}

\clearpage
\normalsize
\subsection{Jost 350 \& GFS Neohellenic Math}
\setcounter{equation}{0}
\defaultfontfeatures{RawFeature={+axis={wght=350}}}
\setmainfont[
    Scale=0.95,
    ItalicFont=Jost-Italic-VariableFont_wght.ttf,
    BoldFont=Jost-VariableFont_wght.ttf,
    BoldItalicFont=Jost-Italic-VariableFont_wght.ttf,
    BoldFeatures={RawFeature={+axis={wght=500}}},
    BoldItalicFeatures={RawFeature={+axis={wght=500}}}
]{Jost-VariableFont_wght.ttf}
\setmathfont[version=jost,mathrm=sym]{GFS Neohellenic Math}
\mathversion{jost}
\vspace*{-1ex}
\small
\begin{latexcode}
\defaultfontfeatures{RawFeature={+axis={wght=350}}}
\setmainfont{Jost-VariableFont_wght.ttf}[
  Scale=0.95,
  ItalicFont=Jost-Italic-VariableFont_wght.ttf,
  BoldFont=Jost-VariableFont_wght.ttf,
  BoldItalicFont=Jost-Italic-VariableFont_wght.ttf,
  BoldFeatures={RawFeature={+axis={wght=500}}},
  BoldItalicFeatures={RawFeature={+axis={wght=500}}}]
\setmathfont{GFS Neohellenic Math}
\end{latexcode}
\vspace*{-1ex}
\abovedisplayskip=6pt plus 3pt minus 3pt
\belowdisplayskip=6pt plus 3pt minus 3pt
\mathsamplerus{jost}

\setmainfont{STIX Two Text}
\setmonofont{PT Mono}[Scale=0.9]
\setmathfont{STIX Two Math}

\clearpage
\phantomsection
\addcontentsline{toc}{section}{Список литературы}%
\printbibliography[notkeyword=example,notkeyword=ctan,notkeyword=soft,notkeyword=question,notkeyword=font,resetnumbers=1]
\phantomsection
\addcontentsline{toc}{section}{Ссылки на вопросы и обсуждения}%
\printbibliography[keyword=question,title={Ссылки на вопросы и обсуждения}]
\phantomsection
\addcontentsline{toc}{section}{Ссылки на пакеты CTAN}%
\printbibliography[keyword=ctan,title={Ссылки на пакеты CTAN}]
\phantomsection
\addcontentsline{toc}{section}{Ссылки на программное обеспечение и сервисы}%
\printbibliography[keyword=soft,title={Ссылки на программное обеспечение и сервисы}]
\phantomsection
\addcontentsline{toc}{section}{Ссылки на шрифты}%
\printbibliography[keyword=font,title={Ссылки на шрифты}]

\clearpage
\appendix
\section{Предметный указатель с помощью xindy}\label{sec:xindy}
\exe{xindy} \parencite{ctan-xindy} --- очень мощная программа, она позволяет задавать правила
сортировки списков и объединения их в группы (по первой букве или другими
способами) очень гибко. Кроме того, с ней не возникает никаких проблем при работе
в кодировке UTF-8. Поставляемые по умолчанию наборы правил
сортировки не вполне подходят к многоязычным документам
с разными алфавитами (например, кириллицей и латиницей). Дело в том, что
сортировка проводится посредством отображения алфавита в некие списки
байтов (которые потом и сортируются), и эти списки для латиницы и кириллицы
жестко заданы и перекрываются. То есть, некоторые русские и английские буквы
объединяются в группы, которые разделить невозможно. Поэтому для многоязычного
предметного указателя придется самостоятельно соорудить список правил для
сортировки (пример таких правил для русского и английского языков см.\ на
рис.~\ref{xindy1}).
\begin{figure}[tp]
\begin{xindycode}
(define-letter-groups ("А" "Б" "В" "Г" "Д" "Е" "Ж" "З" "И" "Й" "К"
    "Л" "М" "Н" "О" "П" "Р" "С" "Т" "У" "Ф" "Х" "Ц" "Ч" "Ш" "Щ" "Ъ"
    "Ы" "Ь" "Э" "Ю" "Я" "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K"
    "L" "M" "N" "O" "P" "Q" "R" "S" "T" "U" "V" "W" "X" "Y" "Z"
    ))

(define-rule-set "alphabetize"
  :rules (("а" "А") ("б" "Б") ("в" "В") ("г" "Г") ("д" "Д") ("е" "Е")
          ("Ё" "Е") ("ё" "Е") ("ж" "Ж") ("з" "З") ("и" "И") ("й" "Й")
          ("к" "К") ("л" "Л") ("м" "М") ("н" "Н") ("о" "О") ("п" "П")
          ("р" "Р") ("с" "С") ("т" "Т") ("у" "У") ("ф" "Ф") ("х" "Х")
          ("ц" "Ц") ("ч" "Ч") ("ш" "Ш") ("щ" "Щ") ("ъ" "Ъ") ("ы" "Ы")
          ("ь" "Ь") ("э" "Э") ("ю" "Ю") ("я" "Я") ("a" "A") ("b" "B")
          ("c" "C") ("d" "D") ("e" "E") ("f" "F") ("g" "G") ("h" "H")
          ("i" "I") ("j" "J") ("k" "K") ("l" "L") ("m" "M") ("n" "N")
          ("o" "O") ("p" "P") ("q" "Q") ("r" "R") ("s" "S") ("t" "T")
          ("u" "U") ("v" "V") ("w" "W") ("x" "X") ("y" "Y") ("z" "Z")
          ))

(define-rule-set "reorderyo"
  :rules (("Е" "8") ("е" "8") ("Ё" "9") ("ё" "9")
	  ))

(define-rule-set "ignore-special"
  :rules (("?" "") ("." "") ("-" "") ("'" "") ("!" "") ("{" "") ("}" "")
          ))

(define-sort-rule-orientations (forward forward))
(use-rule-set :run 0
	      :rule-set ("alphabetize" "ignore-special"))
(use-rule-set :run 1
	      :rule-set ("reorderyo" "ignore-special"))
\end{xindycode}
\caption{Список правил \file{ruseng.xdy} для русско-английского указателя
\exe{xindy}}\label{xindy1}
\end{figure}
В этом наборе сортировка происходит независимо от регистра букв, кроме того, буквы
<<Е>> и <<Ё>> сортируются вместе (но не вперемешку, в одинаковых словах <<Ё>> идёт после <<Е>>).

Отмечу также, что \exe{xindy} полезна не только тем, кто пользуется
\LuaLaTeX\ или \XeTeX\ (и как следствие их файлы \file{.idx} содержат именно русские буквы),
но и пользователям \pdfLaTeX, у которых в \file{.idx} кириллица выглядит как набор макросов
вроде \lcmd{\IeC {\cyrp }}. Более того, при этом не потребуются никакие внешние фильтры, как для \exe{upmendex} выше.
При добавлении строки \mintinline{lisp}|(merge-rule "\IeC {\cyrp }" "п" :string)| в приведённый на рис.~\ref{xindy1} список правил
включится обработка строчной буквы <<П>>, записанной в таком экзотическом виде. А~для тех, кто
еще пользуется 8-битными кодировками в поставке \exe{xindy} есть готовые наборы правил
вроде \file{tex/inputenc/cp1251}.
На рисунках~\ref{xindy2} и~\ref{xindy3}%
\begin{figure}[tp]
\begin{latexcode}
\usepackage[xindy,noautomatic]{imakeidx}
\makeindex

...

Живут на ёлках\index{ёлка} белки, хоть ёлки и не елки\index{елка}.

...

\printindex
\end{latexcode}
\caption{Предметный указатель в тексте документа}\label{xindy2}
\end{figure}%
\begin{figure}[tp]
\begin{shcode}
% lualatex doc.tex

...

% texindy -M ruseng doc.idx

...

% lualatex doc.tex

...

%
\end{shcode}
\caption{Компиляция документа с предметным указателем}\label{xindy3}
\end{figure}
можно увидеть, как именно программируется предметный указатель в тексте, и как он подключается в два прохода.

\end{document}

